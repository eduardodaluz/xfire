<project
  default="jar:install"
  xmlns:j="jelly:core"
  xmlns:ant="jelly:ant"
  xmlns:maven="jelly:maven"  
  xmlns:i="jelly:interaction">

  <ant:path id="xmlbeans.path">
    <ant:path refid="maven.dependency.classpath"/>
    <ant:pathelement path="${maven.build.dest}"/>
    <ant:pathelement path="${maven.test.dest}"/>
  </ant:path>
  
  
  <!-- 
    Generate XMLBeans objects for all the schemas in src/test-schemas 
    and make the WeatherService
   --> 
  <goal name="generate-test">
    
    <ant:delete dir="${maven.build.dir}/xfire-xmlbeans-test"/>
    <ant:mkdir dir="${maven.build.dir}/xfire-xmlbeans-test"/>
  
    <java classname="org.apache.xmlbeans.impl.tool.SchemaCompiler"
          classpathref="xmlbeans.path"
          fork="true">
      <arg value="-d"/>
      <arg value="${maven.build.dir}/xfire-xmlbeans-test"/>
      <arg value="${basedir}/src/wsdl/echo.wsdl"/>
      <arg value="${basedir}/src/wsdl/echoWrapped.wsdl"/>
      <arg value="${basedir}/src/wsdl/globalweather-twoporttypes.wsdl"/>
    </java>
  	
  	<copy todir="${maven.test.dest}">
      <fileset dir="${maven.build.dir}/xfire-xmlbeans-test/"/>
    </copy>

  	
  	<ant:delete dir="${maven.build.dir}/test-services"/>
  	<ant:mkdir dir="${maven.build.dir}/test-services"/>
  	
  	<ant:path id="wsgen.path">
  	  <ant:path refid="maven.dependency.classpath"/>
  	  <ant:pathelement path="${maven.build.dest}"/>
  	  <ant:pathelement path="${maven.test.dest}"/>
   	  <ant:pathelement path="${maven.build.dir}/xfire-xmlbeans-test"/>
  	</ant:path>
  	
  	<ant:taskdef name="wsgen" classname="org.codehaus.xfire.gen.WsGenTask" classpathref="wsgen.path"/>
  		
  	<wsgen outputDirectory="${maven.build.dir}/test-services"
  	       wsdl="${basedir}/src/wsdl/echo.wsdl"
  	       package="jsr181.echo.bare"
           binding="xmlbeans"/>
  	
  	<wsgen outputDirectory="${maven.build.dir}/test-services"
  	  	       wsdl="${basedir}/src/wsdl/echoWrapped.wsdl"
  	  	       package="jsr181.echo.wrapped"
               binding="xmlbeans"/>
  	
  	<wsgen outputDirectory="${maven.build.dir}/test-services"
  	  	  	       wsdl="${basedir}/src/wsdl/globalweather-twoporttypes.wsdl"
  	  	  	       package="jsr181.echo.globalweather"
                   binding="xmlbeans"/>
  	
  	<!-- JAXB -->
	<wsgen outputDirectory="${maven.build.dir}/test-services"
	  	  	  	       wsdl="${basedir}/src/wsdl/globalweather.wsdl"
	  	  	  	       package="jsr181.jaxb.globalweather"/>	
  	
  	<wsgen outputDirectory="${maven.build.dir}/test-services"
  		  	  	  	       wsdl="${basedir}/src/wsdl/oneway.wsdl"
  		  	  	  	       package="jsr181.jaxb.oneway"/>	
  	
  	<wsgen outputDirectory="${maven.build.dir}/test-services"
  	  	   wsdl="${basedir}/src/wsdl/auth.wsdl"
  	  	   package="jsr181.jaxb.auth"/>	
  	  	  	
  	<ant:path id="test.services" location="${maven.build.dir}/test-services"/>

  	<maven:addPath id="maven.test.compile.src.set" refid="test.services"/>
  </goal>

  <preGoal name="test:compile">
    <attainGoal name="generate-test"/>
  </preGoal>
  
</project>