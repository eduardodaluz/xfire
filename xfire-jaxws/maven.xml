<project
  default="jar:install"
  xmlns:j="jelly:core"
  xmlns:ant="jelly:ant"
  xmlns:maven="jelly:maven"  
  xmlns:i="jelly:interaction">

  <goal name="generate-test">
  	
  	<ant:delete dir="${maven.build.dir}/test-services"/>
  	<ant:mkdir dir="${maven.build.dir}/test-services"/>
  	
  	<ant:path id="wsgen.path">
  	  <ant:path refid="maven.dependency.classpath"/>
  	  <ant:pathelement path="${maven.build.dest}"/>
  	  <ant:pathelement path="${maven.test.dest}"/>
   	  <ant:pathelement path="${maven.build.dir}/xfire-xmlbeans-test"/>
  	</ant:path>
  	  	
  	<ant:taskdef name="wsgen" classname="org.codehaus.xfire.gen.WsGenTask" classpathref="wsgen.path"/>
  	  		
  	<!-- Build stubs and clients for tests -->
	<wsgen outputDirectory="${maven.build.dir}/test-services"
	  wsdl="${basedir}/src/wsdl/echo.wsdl"
	  package="services.echo"
	  profile="org.codehaus.xfire.jaxws.gen.JAXWSProfile"/>	
  	
  	<wsgen outputDirectory="${maven.build.dir}/test-services"
  		  wsdl="${basedir}/src/wsdl/headerout.wsdl"
  		  package="services.headerout"
  		  profile="org.codehaus.xfire.jaxws.gen.JAXWSProfile"/>	
  	  	
  	<ant:path id="test.services" location="${maven.build.dir}/test-services"/>

  	<maven:addPath id="maven.test.compile.src.set" refid="test.services"/>
  </goal>

  <preGoal name="test:compile">
    <attainGoal name="generate-test"/>
  </preGoal>
  
</project>