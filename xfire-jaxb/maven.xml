<project
        default="jar:install"
        xmlns:j="jelly:core"
        xmlns:ant="jelly:ant"
        xmlns:maven="jelly:maven"
        xmlns:i="jelly:interaction">

    <ant:path id="jaxb.path">
        <ant:path refid="maven.dependency.classpath"/>
        <ant:pathelement path="${maven.build.dest}"/>
        <ant:pathelement path="${maven.test.dest}"/>
    </ant:path>

    <ant:taskdef name="xjc" classname="com.sun.tools.xjc.XJCTask" classpathref="jaxb.path"/>

    <!--
     Generate jaxb objects for all the schemas in src/test-schemas
     and make the WeatherService
    -->
    <goal name="generate-test">

        <ant:delete dir="${maven.build.dir}/generated-test"/>
        <ant:mkdir dir="${maven.build.dir}/generated-test"/>

        <xjc target="${maven.build.dir}/generated-test">
            <schema dir="src/test-schemas" includes="*.xsd"/>
        </xjc>

        <ant:path id="xfire.jaxb.generated.test"
                  location="${maven.build.dir}/generated-test"/>

        <maven:addPath id="maven.test.compile.src.set"
                       refid="xfire.jaxb.generated.test"/>
    </goal>

    <preGoal name="test:compile">
        <attainGoal name="generate-test"/>
    </preGoal>

</project>