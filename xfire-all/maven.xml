<project default="multiproject:install" xmlns:c="jelly:core" xmlns:maven="jelly:maven" xmlns:ant="jelly:ant" xmlns:util="jelly:util">

	<postGoal name="build:start">
		<!-- In order to process dependencies -->
		<maven:reactor goals="build:start" basedir="${basedir}/.." includes="${maven.multiproject.includes}" excludes="${maven.multiproject.excludes},xfire-all/project.xml"/>
		<!-- Collects data -->
		<maven:reactor collectionVar="modules" collectOnly="true" basedir="${basedir}/.." includes="${maven.multiproject.includes}" excludes="${maven.multiproject.excludes},xfire-all/project.xml"/>
		
		<!-- Prepares -->
		<ant:mkdir dir="${maven.build.dest}"/>
		<ant:mkdir dir="${maven.test.dest}"/>
		<ant:path id="maven.test.compile.src.set"/>
		
		<c:forEach items="${modules}" var="module" indexVar="i">
			<!-- Adds source folders -->
			<ant:path id="xfire.all.source.${i}" location="${module.build.sourceDirectory}"/>
			<maven:addPath id="maven.compile.src.set" refid="xfire.all.source.${i}"/>

			<!-- Adds tests source folders -->
			<c:if test="${module.artifactId != 'xfire-xmlbeans'}">
				<util:file var="testFolder" name="${module.build.unitTestSourceDirectory}"/>
				<c:if test="${testFolder.exists()}">
					<ant:path id="xfire.all.test.source.${i}" location="${module.build.unitTestSourceDirectory}"/>
					<maven:addPath id="maven.test.compile.src.set" refid="xfire.all.test.source.${i}"/>
				</c:if>
			</c:if>
			
			<!-- Adds dependencies -->
			<c:forEach items="${module.artifacts}" var="dependency" indexVar="j">
				<c:if test="${dependency.groupId != 'xfire'}">
					<ant:path id="xfire.all.dependency.${i}.${j}" location="${dependency.path}"/>
					<maven:addPath id="maven.dependency.classpath" refid="xfire.all.dependency.${i}.${j}"/>
				</c:if>
			</c:forEach>
			
			<!-- Copy resources -->
			<maven:copy-resources resources="${module.build.resources}" todir="${maven.build.dest}"/>
			<maven:copy-resources resources="${module.build.unitTest.resources}" todir="${maven.test.dest}"/>
		</c:forEach>
		<c:set var="sourcesPresent" value="true"/>
		<c:set var="unitTestSourcesPresent" value="true"/>
	</postGoal>

	<goal name="eclipse:generate-project">
		<ant:echo>Its just a meta project. No Eclipse project for you.</ant:echo>
	</goal>
	<goal name="eclipse:generate-classpath">
		<ant:echo>Its just a meta project. No Eclipse project for you.</ant:echo>
	</goal>

</project>