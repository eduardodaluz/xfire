<project
    default="jar:install"
    xmlns:j="jelly:core"
    xmlns:ant="jelly:ant"
    xmlns:maven="jelly:maven"
    xmlns:i="jelly:interaction">

    <!--
        Generate backport175 annotations for all annotated classes in test
     -->
    <goal name="generate-backport175-annotations">

        <ant:path id="generate.path">
            <ant:pathelement path="${maven.build.dest}"/>
            <ant:path refid="maven.dependency.classpath"/>
            <ant:pathelement path="${maven.test.dest}"/>
        </ant:path>

        <ant:taskdef name="annotationc"
            classname="org.codehaus.backport175.compiler.task.AnnotationCTask"
            classpathref="generate.path"/>


        <annotationc>
            <fileset dir="${maven.src.dir}/test">
                <include name="**/backport175/*"/>
            </fileset>
            <classpath path="${maven.build.dir}/test-classes"/>
        </annotationc>
    </goal>

    <postGoal name="test:compile">
        <attainGoal name="generate-backport175-annotations"/>
    </postGoal>

</project>